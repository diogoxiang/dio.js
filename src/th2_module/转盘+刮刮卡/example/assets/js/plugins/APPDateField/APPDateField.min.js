!function(){"use strict";function t(t,e){function s(t){t&&(t.style.fontSize=n+"px"),n-=3}var o=Math.round(e/a.step),i=Math.round(t.height()/a.step),n=a.fontSize;o>=i?o=i-1:o>=1&&3>=o?1==o?o=3-o:2==o?o=3-o:3==o&&(o=0):0>=o&&(o=Math.abs(o)+3);for(var p=0;4>p;p++){var r=t.find("li").eq(o-p);s(r[0])}n=a.fontSize;for(var h=0;4>h;h++){var r=t.find("li").eq(o+h);s(r[0])}}function e(t,e,s,o,i){if(!e||""==e)return!1;var s=s||0,o=o&&!0,i=i||10,n=t,p=a.step;o?$(e).off().animate({top:s+"px"}):$(e).off().animate({top:s+"px"},i,function(){var t=s%p;if(0!=t){var e=p*Math.round(s/p)-(Math.abs(t)<p?0:p);$(this).off().animate({top:e+"px"}),n.y=e}})}var s=this,a={fontSize:20,step:30,isCircle:!1,tpl:'<div class="app-dateField-main"><div class="app-dateField-top"><span class="app-dateField-btnCancel">取消</span><span class="app-dateField-btnOk">完成</span></div><div class="app-dateField-center"><ul class="app-dateField-year-con"></ul><ul class="app-dateField-month-con"></ul><ul class="app-dateField-date-con"></ul><div class="app-center-current"></div></div><div class="app-dateField-bottom"></div></div>'},o=function(t,e,s,o){var i=this,e=e||{};i.selectElm=$?$("#"+t)[0]:document.getElementById(t),i.htmlDom=null,i.appWrap=$?$("#APPDateField-con")[0]:document.getElementById("APPDateField-con"),i.loaded=!1,i.isRender=!1,(e.complate&&void 0!=e.complate&&"function"==typeof e.complate||s&&"function"==typeof s)&&(i.complate=e.complate?e.complate:s),(e.cancel&&void 0!=e.cancel&&"function"==typeof e.cancel||o&&"function"==typeof o)&&(i.cancel=e.cancel?e.cancel:o),i.currentTop=0,i.step=a.step,i.valList=[],i.currDate=[],i.app_top,i.app_btnCancel,i.app_btnOk,i.app_center_con,i.app_y_con,i.app_m_con,i.app_d_con,i.app_cen_c,i.opts={year:(new Date).getFullYear(),month:(new Date).getMonth()+1,date:(new Date).getDate(),hours:(new Date).getHours(),minutes:(new Date).getMinutes(),seconds:(new Date).getSeconds(),upYear:e.upYear||60,downYear:e.downYear||60,isCN:e.isCN||void 0==e.isCN?!0:e.isCN,isVal:e.isVal||void 0==e.isVal?!1:e.isVal,isCircle:e.isCircle||void 0==e.isCircle?!1:e.isCircle,showYear:e.showYear||void 0==e.showYear?!0:e.showYear,showMonth:e.showMonth||void 0==e.showMonth?!0:e.showMonth,showDate:e.showDate||void 0==e.showDate?!0:e.showDate,showTime:e.showTime||!1,commer:e.commer||"-"},a.isCircle=i.opts.isCircle,i._init()};o.prototype._init=function(){var t=this;t.appWrap?t.show():(t.appWrap=document.createElement("div"),t.appWrap.setAttribute("id","APPDateField-con"),t.appWrap.setAttribute("class","APPDateField-con"),document.body.appendChild(t.appWrap),t._render())},o.prototype._getInitialValue=function(){var t=this,e=t.selectElm.value||t.selectElm.innerHTML;e&&""!==e&&(t.valList=t.subDefaultDate(e||"")),t.setCurrentTXT(t.valList)},o.prototype.show=function(){var t=this;$?$(t.appWrap).off().fadeIn("fast"):t.appWrap.style.display="block",t.isRender=!0,t._render()},o.prototype.hide=function(){var t=this;$?$(t.appWrap).off().fadeOut("fast"):t.appWrap.style.display="none",t.isRender=!0},o.prototype._load=function(){var t=this;t.loaded||t._render()},o.prototype._render=function(){function t(){e.app_center_con.find("ul").css({width:s.width()/3}),e.opts.showYear&&e.opts.showMonth&&!e.opts.showDate?(e.app_center_con.find("ul").css({width:s.width()/2}),e.app_y_con.css({left:0}),e.app_m_con.css({left:s.width()/2}),e.app_d_con.css({left:s.width()/2*2,display:"none"})):!e.opts.showYear&&e.opts.showMonth&&e.opts.showDate?(e.app_center_con.find("ul").css({width:s.width()/2}),e.app_y_con.css({left:0,display:"none"}),e.app_m_con.css({left:0}),e.app_d_con.css({left:s.width()/2})):(e.opts.showYear&&e.opts.showMonth&&e.opts.showDate||e.opts.showTime)&&(e.app_y_con.css({left:0}),e.app_m_con.css({left:s.width()/3}),e.app_d_con.css({left:s.width()/3*2}))}var e=this,s=$(e.appWrap).html(a.tpl);e.htmlDom=s,e.app_main=s.find(".app-dateField-main"),e.app_top=s.find(".app-dateField-top"),e.app_btnCancel=s.find(".app-dateField-btnCancel"),e.app_btnOk=s.find(".app-dateField-btnOk"),e.app_center_con=s.find(".app-dateField-center"),e.app_y_con=s.find(".app-dateField-year-con"),e.app_m_con=s.find(".app-dateField-month-con"),e.app_d_con=s.find(".app-dateField-date-con"),e.app_cen_c=s.find(".app-center-current"),window.onresize=t,t(),e._getInitialValue(),e.loaded=!0,e.opts.showTime?(e.createHours(),e.createMins(),e.createSeconds()):(e.createYear(),e.createMonth(),e.createDate()),e._events()},o.prototype.createYear=function(t,e){var s=this,t=t||s.opts.upYear,e=e||s.opts.downYear,a=new Date,o=a.getFullYear(),i=[],n="",p="";if(s.loaded){for(var r=1;t+1>r;r++)n=s.opts.isCN?"<li"+p+">"+(o-r)+"年</li>":"<li>"+(o-r)+"</li>",i.unshift(n);for(var h=0;e>=h;h++)n=s.opts.isCN?"<li"+p+">"+(o+h)+"年</li>":"<li>"+s.dateFm(o+h)+"</li>",i.push(n);s.app_y_con.html(i.join(""))}s.currentTop=s.step*((s.valList[0]||s.opts.year)-parseInt(s.app_y_con.find("li").eq(0).text())-3),s._scrollTop(s.app_y_con[0],-s.currentTop,!0,200)},o.prototype.createMonth=function(){var t=this,e=new Date,s=(t.dateFm(e.getMonth()+1),1),a=[],o="";if(t.loaded){for(;13>s;)o=t.opts.isCN?"<li>"+s+"月</li>":"<li>"+t.dateFm(s)+"</li>",a.push(o),s++;t.app_m_con.html(a.join(""))}t._scrollTop(t.app_m_con[0],-(t.step*parseInt(t.valList[1]||t.opts.month)-4*t.step),!0,200)},o.prototype.createDate=function(){var t=this,e=new Date,s=(e.getFullYear(),t.dateFm(e.getMonth()+1),t.dateFm(e.getDate()),0),a=31,o=[],i="";if(t.loaded){if(t.valList[1]||2==t.opts.month)for(a=(t.valList[0]||t.opts.year%4==0)&&(t.valList[0]||t.opts.year%100!=0)||t.valList[0]||t.opts.year%400==0?29:28;31>s;)i=s>=a?t.opts.isCN?'<li style="display:none;">'+(s+1)+"日</li>":'<li style="display:none;">'+t.dateFm(s+1)+"</li>":t.opts.isCN?"<li>"+(s+1)+"日</li>":"<li>"+t.dateFm(s+1)+"</li>",o.push(i),s++;else for(;31>s;)i=t.opts.isCN?"<li>"+(s+1)+"日</li>":"<li>"+t.dateFm(s+1)+"</li>",o.push(i),s++;t.app_d_con.html(o.join(""))}t._scrollTop(t.app_d_con[0],-(t.step*parseInt(t.valList[2]||t.opts.date)-4*t.step),!0,200)},o.prototype.createHours=function(){var t=this,e=[],s="",a=0;if(t.loaded){for(;24>a;)s=t.opts.isListType?"<li>"+a+"时</li>":"<li>"+t.dateFm(a)+"</li>",e.push(s),a++;t.app_y_con.html(e.join(""))}t.currentTop=t.step*(t.opts.hours-parseInt(t.app_y_con.find("li").eq(0).text())-3),t._scrollTop(t.app_y_con[0],-t.currentTop,!0,200)},o.prototype.createMins=function(){var t=this,e=[],s="",a=0;if(t.loaded){for(;60>a;)s=t.opts.isListType?"<li>"+a+"分</li>":"<li>"+t.dateFm(a)+"</li>",e.push(s),a++;t.app_m_con.html(e.join(""))}t._scrollTop(t.app_m_con[0],-(t.step*parseInt(t.opts.minutes+1)-4*t.step),!0,200)},o.prototype.createSeconds=function(){var t=this,e=[],s="",a=0;if(t.loaded){for(;60>a;)s=t.opts.isListType?"<li>"+a+"秒</li>":"<li>"+t.dateFm(a)+"</li>",e.push(s),a++;t.app_d_con.html(e.join(""))}t._scrollTop(t.app_d_con[0],-(t.step*parseInt(t.opts.seconds+1)-4*t.step),!0,200)},o.prototype.getYear=function(){return this.year=parseInt(this.getCurrentTXT(this.app_y_con)),this.year},o.prototype.setYear=function(t){this.year=t},o.prototype.getMonth=function(){return this.month=parseInt(this.getCurrentTXT(this.app_m_con)),this.month},o.prototype.setMonth=function(t){this.month=t},o.prototype.getDate=function(){return this.date=parseInt(this.getCurrentTXT(this.app_d_con)),this.date},o.prototype.setDate=function(t){this.date=t},o.prototype.getCurrentTXT=function(t){var e=Math.round(t.position().top)/this.step;0==e?e=3:e>=1&&3>=e?1==e?e=2:2==e?e=1:3==e&&(e=0):0>e&&(e=Math.abs(e)+3);var s=t.find("li").eq(e).text();return s},o.prototype.setCurrentTXT=function(t){var e=this,s=t,a=e.opts;s&&s.length>0&&(a.showTime?(a.hours=isNaN(parseInt(s[0]))?a.hours:parseInt(s[0]),a.minutes=isNaN(parseInt(s[1]))?a.minutes:parseInt(s[1]),a.seconds=isNaN(parseInt(s[2]))?a.seconds:parseInt(s[2])):(a.showYear||(s[0]=""),a.showDate||(s[2]=""),a.year=isNaN(parseInt(s[0]))?a.year:parseInt(s[0]),a.month=isNaN(parseInt(s[1]))?a.month:parseInt(s[1]),a.date=isNaN(parseInt(s[2]))?a.date:parseInt(s[2])));var o,i="",n="",p="";a.showTime?(i=a.isCN?a.hours+"时":a.hours+":",n=a.isCN?a.minutes+"分":e.dateFm(a.minutes)+":",p=a.isCN?a.seconds+"秒":e.dateFm(a.seconds),o=i+n+p):(i=a.isCN?a.year+"年":a.year+a.commer,n=a.isCN?a.month+"月":e.dateFm(a.month)+a.commer,p=a.isCN?a.date+"日":e.dateFm(a.date),a.showYear&&a.showMonth&&!a.showDate?(i=a.isCN?a.year+"年":a.year+a.commer,n=a.isCN?a.month+"月":e.dateFm(a.month),o=i+n):!a.showYear&&a.showMonth&&a.showDate?(n=a.isCN?a.month+"月":e.dateFm(a.month)+a.commer,p=a.isCN?a.date+"日":e.dateFm(a.date),o=n+p):o=i+n+p),e.selectElm.value?e.selectElm.value=o:e.selectElm.innerHTML=o},o.prototype.subDefaultDate=function(t){var e=this,s=[],a=e.opts;if(t||""!=t)s=a.isCN?t.match(/(\d)+/gi):t.match(/(\d)+/gi)||t.split(a.commer||"-");else{var o=new Date;a.showTime?(s.push(o.getHours()),s.push(o.getMinutes()),s.push(o.getSeconds())):(s.push(o.getFullYear()),s.push(o.getMonth()+1),s.push(o.getDate()))}return a.showTime?(e.valList=s,s):(3==s.length?(a.showYear||(s[0]=""),a.showDate||(s[2]="")):(a.showYear||s.unshift(""),a.showDate||s.push("")),e.valList=s,s)},o.prototype.getCurrentDate=function(t,e,s,a){var o=this.currDate;return t&&void 0!=t&&null!=t&&0!=t?t:t=o[0],e&&void 0!=e&&null!=e&&0!=e?e:e=o[1],s&&void 0!=s&&null!=s&&0!=s?s:s=o[2],o[0]=t,o[1]=e,o[2]=s,o},o.prototype._scrollTop=function(s,a,o,i){e(this,s,a,o,i),t($(s),a)},o.prototype._events=function(){{var t=this,e=t.opts,s=t.app_y_con,a=t.app_m_con,o=t.app_d_con,p=t.app_main;new i(s[0],p[0],e),new i(a[0],p[0],e),new i(o[0],p[0],e)}t.app_btnOk.bind("touchend",n(t,t._complate)),t.app_btnCancel.bind("touchend",n(t,t._cancel)),t.app_btnOk.bind("touchstart",t.endEvent),t.app_btnCancel.bind("touchstart",t.endEvent)},o.prototype.endEvent=function(t){t.preventDefault(),t.stopPropagation()},o.prototype._complate=function(t){var e=[];e.push(this.getYear()),e.push(this.getMonth()),e.push(this.getDate()),this.currDate=e,this.setCurrentTXT(e),this.hide(),this.complate.call(this,t)},o.prototype._cancel=function(t){this.hide()},o.prototype.dateFm=function(t){return 10>t?"0"+t:t},s.APPDateField=o;var i=function(t,e,s){this.elm=t,this.elmParent=e,this.hasTouch="ontouchstart"in window||window.TouchEvent,this.isMobile=/Mobile/gi.test(navigator.userAgent),this.isTouchStart=!1,this.options=s,this.vlist={year:this.options.year,month:this.options.month,date:this.options.date,hours:this.options.hours,minutes:this.options.minutes,seconds:this.options.seconds},this.startY=0,this.dy=0,this.h=$(this.elm).height(),this.moveY=0,this.top=$(this.elm).position().top,this.step=a.step,this.fontSize=a.fontSize,this.offset={left:this.elmParent.offsetLeft,top:this.elmParent.offsetTop,width:$(this.elmParent).width(),height:$(this.elmParent).height()},this.startTime=Date.now||function(){return(new Date).getTime()},this._initEvent(t)};i.prototype={_initEvent:function(t){this.hasTouch?(t.addEventListener("touchstart",this,!1),t.addEventListener("touchmove",this,!1),t.addEventListener("touchend",this,!1)):(t.addEventListener("mousedown",this,!1),t.addEventListener("mousemove",this,!1),t.addEventListener("mouseup",this,!1))},handleEvent:function(t){switch(t.type){case"touchstart":this._start(t.targetTouches[0],t);break;case"touchmove":this._move(t.changedTouches[0],t);break;case"touchend":this._end(t.changedTouches[0],t);break;case"mousedown":this._start(t);break;case"mousemove":this._move(t);break;case"mouseup":this._end(t)}/SELECT|TEXTAREA|INPUT/.test(t.target.tagName.toUpperCase())&&t.preventDefault(),t.preventDefault(),t.stopPropagation()},_start:function(t,e){this.isTouchStart=!0,this.y=this.top=$(this.elm).position().top,this.h=$(this.elm).height(),this.startY=this.top,this.moveY=t.pageY,this.startTime=Date.now||function(){return(new Date).getTime()}},_move:function(e,s){if(this.isTouchStart){var a=$(e.target).parent("ul");a.find("li").css("fontSize",this.fontSize+"px"),this.dy=this.y-(this.moveY-e.pageY);var o=this._formateTop(this.dy);this._scrollTop(a[0],o,!0,0),t(a,o)}},_end:function(e,s){this.isTouchStart=!1;var a=$(e.target).parent("ul"),o=e.pageY-this.moveY,i=this.y+o,n=o/((new Date).getTime()-this.startTime),p=(e.timeStamp||Date.now())-this.startTime;Math.abs(n)>.5&&(i-=n*this.step);var r=this._formateTop(i);this._scrollTop(a[0],r,!1,p),t(a,r)},_formateTop:function(t){var e=this.step,s=this.h;if(t>=3*e)t=3*e;else{if(!(Math.abs(t)>=s-4*e))return t;t=-(s-4*e)}return this.y=t,t},_scrollTop:function(t,s,a,o){if(!t||""==t)return!1;var s=s||0,a=a&&!0,o=o||10,i=this,n=i.step;if(e(i,t,s,a,o),!i.isTouchStart){var r=p(Math.round($(t).position().top/n)),h=$(t).find("li").eq(r).text();if($(t).hasClass("app-dateField-month-con")){i.vlist.month=parseInt(h);var l=p(Math.round($(".app-dateField-year-con").position().top/n));i.vlist.year=parseInt($(".app-dateField-year-con").find("li").eq(l).text())}else if($(t).hasClass("app-dateField-year-con")){i.vlist.year=parseInt(h);var l=p(Math.round($(".app-dateField-month-con").position().top/n));i.vlist.month=parseInt($(".app-dateField-month-con").find("li").eq(l).text())}else{i.vlist.date=parseInt(h);var l=p(Math.round($(".app-dateField-year-con").position().top/n));i.vlist.year=parseInt($(".app-dateField-year-con").find("li").eq(l).text());var c=p(Math.round($(".app-dateField-month-con").position().top/n));i.vlist.month=parseInt($(".app-dateField-month-con").find("li").eq(c).text())}if($(t).hasClass("app-dateField-month-con")||$(t).hasClass("app-dateField-year-con")){var d=0;if(2==i.vlist.month){d=i.vlist.year%4==0&&i.vlist.year%100!=0||i.vlist.year%400==0?29:28;for(var u=0;31>u;u++)u>=d&&$(".app-dateField-date-con").find("li").eq(u).css("display","none")}else for(var u=0;31>u;u++)$(".app-dateField-date-con").find("li").eq(u).css("display","block")}}}};var n=function(t,e){for(var s=[],a=2;a<arguments.length;a++)s.push(arguments[a]);return function(a){s.push(a),e.call(t,a,s)}},p=function(t){return 0==t?t=3:t>=1&&3>=t?1==t?t=2:2==t?t=1:3==t&&(t=0):t=Math.abs(t)+3,t};"function"==typeof define?define(function(){return o}):"undefined"!=typeof exports?module.exports=o:window.APPDateField=o}.call(this);